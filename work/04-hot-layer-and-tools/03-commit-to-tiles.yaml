id: commit-to-tiles
status: planned
summary: On pen/eraser commit, invalidate affected tiles and bake asynchronously.
context:
  - This is the handoff between the hot layer and the tile cache.
  - Keeps input loop fast while ensuring the world updates promptly.
prerequisites:
  - work/03-tile-renderer/03-invalidation-and-bake.yaml
  - work/04-hot-layer-and-tools/01-hot-layer-rendering.yaml
acceptance_criteria:
  - Committed shapes trigger tile invalidation and bake scheduling.
  - Drafts are cleared on commit and tiles display baked results.
  - Tests cover a full draw cycle (draft -> commit -> tile update).
  - All tests/typecheck/lint pass:
    - bun --filter @smalldraw/renderer-raster test
    - bun --filter @smalldraw/core test
    - bun --filter @smalldraw/renderer-raster ts:check
    - bun --filter @smalldraw/core ts:check
    - bun --filter @smalldraw/renderer-raster lint
    - bun --filter @smalldraw/core lint
  - mise run validate:all
notes:
  - Keep the API frameworkless.
